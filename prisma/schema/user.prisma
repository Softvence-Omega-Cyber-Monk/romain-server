enum SystemRole {
  SUPER_ADMIN
  ADMIN
  GENERAL_MANAGER
  ADMIN_DIRECTOR
  ACCOUNTANT
  STUDENT
}

model User {
  id String @id @default(uuid())
  firstName String?
  lastName String?
  email String @unique
  phone  String?
  profileImage  String?
  password String
  tokenExpiry  DateTime?
  activationToken  String?
  isActive  Boolean @default(false)
  isDeleted Boolean @default(false)
  role     SystemRole @default(STUDENT)
  //Relationships
  studentProfileId  String? @unique
  studentProfile    Student?  @relation(fields: [studentProfileId], references: [id])

  institutionId          String? 
  institution            Institution?    @relation(fields: [institutionId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
} 


model Student {
  id                String    @id @default(uuid())
  registrationNumber         String?   @unique 

  currentLevelId String?
  currentLevel   Level?  @relation(fields: [currentLevelId], references: [id])
  

  currentSessionId String?
  currentSession   Session? @relation(fields: [currentSessionId], references: [id])


  // To track unsettled debt from previous years for registration block
  previousBalance Decimal @default(0.00)

  status            StudentStatus @default(ON_HOLD)
  // Relationships
  institutionId          String
  institution            Institution    @relation(fields: [institutionId], references: [id])
  isRegistered      Boolean   @default(true) 

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  User User?


  StudentDebt StudentDebt[]

  Transaction Transaction[]
}


enum StudentStatus {
  ON_HOLD
  ACTIVE 
  SUSPENDED
}



model Institution {
  id          String           @id @default(uuid())
  name        String           @unique
  bannerImage  String?
  address     String
  isActive    Boolean          @default(false) // For Super Admin validation status
  prefix      String           @unique
  bankName   String
  cardHolder  String
  RIB_IBAN    String
  BIC_SWIFT   String
  KYC_documents   String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  student Student[]

  User User[]

  Session Session[]

  Transaction Transaction[]

  FeeType FeeType[]
}